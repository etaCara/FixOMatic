<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ticket Details</title>
  <link rel="stylesheet" href="style.css" />
  <script>
    const username = localStorage.getItem("username");
    if (!username) {
      window.location.href = "index.html";
    }
  </script>
</head>
<body>
  <header class="navbar">
    <h1 class="logo">üõ†Ô∏è Fix-O-Matic</h1>
    <nav>
      <a href="home.html">Home</a>
      <a href="create-ticket.html">Create</a>
      <a href="history.html">History</a>
      <a href="faq.html">FAQ</a>
      <a href="settings.html">Settings</a>
    </nav>
  </header>

  <main class="container">
    <section class="card">
      <h2>üéüÔ∏è Ticket Details</h2>
      <div class="ticket-details" id="ticketDetails">
        <p>Loading ticket data...</p>
      </div>
      <a href="in-process.html" class="back-link">‚Üê Back to Tickets</a>
    </section>
  </main>

  <script>
    async function loadTicketDetails() {
      const urlParams = new URLSearchParams(window.location.search);
      const ticketId = urlParams.get("id");
      const container = document.getElementById("ticketDetails");

      if (!ticketId) {
        container.innerHTML = "<p style='color:red;'>No ticket ID provided in the URL.</p>";
        return;
      }

      try {
        const response = await fetch(`https://fixomatic.onrender.com/tickets/${ticketId}`);
        if (!response.ok) {
          throw new Error("Ticket not found");
        }

        const ticket = await response.json();

        container.innerHTML = `
          <p><strong>ID:</strong> <span>#${ticket.id}</span></p>
          <p><strong>Issue:</strong> <span>${ticket.issue_type}</span></p>
          <p><strong>Description:</strong> <span>${ticket.description}</span></p>
          <p><strong>Assigned To:</strong> <span>${ticket.assigned_to || "Unassigned"}</span></p>
          <p><strong>Status:</strong> <span>${ticket.status}</span></p>
          <p><strong>Severity:</strong> <span>${ticket.severity}</span></p>
          <p><strong>Created On:</strong> <span>${new Date(ticket.created_at).toLocaleDateString()}</span></p>
          <p><strong>Created By:</strong> <span>${ticket.created_by || "Unknown"}</span></p>
        `;
      } catch (err) {
        console.error("Error loading ticket:", err);
        container.innerHTML = "<p style='color:red;'>‚ùå Failed to load ticket details. Please try again later.</p>";
      }
    }

    window.addEventListener("DOMContentLoaded", loadTicketDetails);
  </script>
</body>
</html>
